; ALFONSO MURRIETA VILLEGAS


PROCESSOR 16f877
INCLUDE <p16f877.inc>

;INPUT DATA
IN_1	EQU	H'20'
IN_2	EQU	H'22'
POS_C 	EQU H'24'
POS_D	EQU	H'25'
CAR_C	EQU H'58'
CAR_D	EQU H'59'
N1_SIZ	EQU H'60'
N1_AUX	EQU	H'61'
N2_SIZ	EQU H'62'
N2_AUX	EQU H'63'


;OUTPUT DATA - AUX VARS

OUT_AUX	EQU H'5E'
CONV	EQU H'50'  
COUNT_AUX	EQU H'5F'

OUT_SIZ	EQU H'64'
OUT_AUX_2	EQU H'65'
 
		ORG 0
		GOTO INICIO
		ORG 5

; GENERAL CODE AND ASSIGNMENT		
INICIO
		CLRF	POS_C
		CLRF	POS_D
		CLRF	CAR_C
		CLRF	CAR_D

		MOVLW	0X04
		MOVWF	COUNT_AUX

		MOVLW	0X01
		MOVWF	OUT_AUX
		
		MOVF	IN_1,W
		MOVWF	CONV

		BCF		STATUS,C
		CALL CHECK_P_D

		MOVLW	0X04
		MOVWF	COUNT_AUX
		
		MOVLW	0X00
		MOVWF	OUT_AUX
		
		MOVF	IN_2,W
		MOVWF	CONV

		BCF		STATUS,C
		CALL CHECK_P_D
		GOTO 	ADD_P
		
;CHECK DEC 
CHECK_P_D
		RRF		CONV
		BCF		STATUS,C
		DECFSZ	COUNT_AUX
		GOTO	CHECK_P_D
MAYOR
		MOVLW	0X0A
		SUBWF	CONV,0
		BTFSC	STATUS,C
		GOTO	FIN		
ASIG_1
		MOVF	CONV,W
		BTFSC	OUT_AUX,0
		GOTO	ASIG_2
		GOTO	ASIG_AUX		
ASIG_2
		MOVWF	N1_SIZ
		MOVF	IN_1,W
		GOTO	CHECK_V_D		
ASIG_AUX
		MOVWF	N2_SIZ
		MOVF	IN_2,W
		GOTO	CHECK_V_D
CHECK_V_D
		MOVWF	CONV
		SWAPF	CONV,1
		MOVLW	0X04
		MOVWF	COUNT_AUX
CHECK_V_D_2
		RRF		CONV
		BCF		STATUS,C
		DECFSZ	COUNT_AUX
		GOTO	CHECK_V_D_2
MENOR
		MOVLW	0X0A
		SUBWF	CONV,0
		BTFSC	STATUS,C
		GOTO	FIN
ASIG_B
		MOVF	CONV,W
		BTFSC	OUT_AUX,0
		GOTO	ASIG_B1
		GOTO	ASIG_B2	
ASIG_B1
		MOVWF	N1_AUX
		RETURN
ASIG_B2
		MOVWF	N2_AUX
		RETURN
FIN
		MOVLW	0XFF
		MOVWF	POS_C
		MOVWF	POS_D
		GOTO FIN


;ADD SUBROUTINE 
ADD_P
		MOVF	IN_1,W
		MOVWF	POS_D
		MOVF	IN_2,W
		ADDWF	POS_D
		BTFSC	STATUS,C
		BSF		CAR_C,0
		BTFSC	STATUS,DC
		BSF		CAR_D,0
		MOVLW	0X04
		MOVWF	COUNT_AUX
		MOVF	POS_D,W
		MOVWF	CONV
		BCF		STATUS,C
		CALL CHECK_OUT
		GOTO CH_OUT_2


CHECK_OUT
		RRF		CONV
		BCF		STATUS,C
		DECFSZ	COUNT_AUX
		GOTO	CHECK_OUT	
ASIG_R
		MOVF	CONV,W
		MOVWF	OUT_SIZ
		MOVLW	0X04
		MOVWF	COUNT_AUX
		MOVF	POS_D,W
		MOVWF	CONV
		BCF		STATUS,C
		SWAPF	CONV	
CHECK_OUT2
		RRF		CONV
		BCF		STATUS,C
		DECFSZ	COUNT_AUX
		GOTO	CHECK_OUT2
ASIG_R2
		MOVF	CONV,W
		MOVWF	OUT_AUX_2
		RETURN
CH_OUT_2
		BTFSS	CAR_C,0
		GOTO CAR_C_0
		GOTO CAR_C_1		
CAR_C_0
		MOVLW	0X0A
		SUBWF	OUT_SIZ,W
		BTFSS	STATUS,C		
		GOTO	STA_FIR
		GOTO	STA_SEC
STA_FIR
		BTFSS	CAR_D,0
		GOTO	CAR_D_0
		GOTO	CAR_D_1		
CAR_D_0
		MOVLW	0X0A
		SUBWF	OUT_AUX_2,W
		BTFSS	STATUS,C		
		GOTO	STA_1
		GOTO	STA_2
CAR_D_1
		GOTO	STA_3
STA_SEC
		BTFSS	CAR_D,0
		GOTO	CAR_D2_0
		GOTO	CAR_D2_1
CAR_D2_0
		MOVLW	0X0A
		SUBWF	OUT_AUX_2,W
		BTFSS	STATUS,C		
		GOTO	STA_4
		GOTO	STA_5
CAR_D2_1
		GOTO	STA_6
CAR_C_1
		MOVLW	0X03
		SUBWF	OUT_SIZ,W
		BTFSS	STATUS,C		
		GOTO	STA_AUX
		GOTO	STA_9
STA_AUX
		MOVLW	0X0A
		SUBWF	OUT_AUX_2,W
		BTFSS	STATUS,C		
		GOTO	STA_7
		GOTO	STA_8
		
		
;TABLE AND CASES 
STA_1
		MOVLW 0X00
		ADDWF	POS_D
		GOTO LOOP
STA_2
		MOVLW 0X06
		ADDWF	POS_D
		GOTO LOOP
STA_3
		MOVLW 0X06
		ADDWF	POS_D
		GOTO LOOP
STA_4
		MOVLW 0X60
		ADDWF	POS_D
		MOVLW	0X01
		MOVWF	POS_C
		GOTO LOOP
STA_5
		MOVLW 0X66
		ADDWF	POS_D
		MOVLW	0X01
		MOVWF	POS_C
		GOTO LOOP
STA_6
		MOVLW 0X66
		ADDWF	POS_D
		MOVLW	0X01
		MOVWF	POS_C
		GOTO LOOP
STA_7
		MOVLW 0X60
		ADDWF	POS_D
		MOVLW	0X01
		MOVWF	POS_C
		GOTO LOOP
STA_8
		MOVLW 0X66
		ADDWF	POS_D
		MOVLW	0X01
		MOVWF	POS_C
		GOTO LOOP
STA_9
		MOVLW 0X66
		ADDWF	POS_D
		MOVLW	0X01
		MOVWF	POS_C
		GOTO LOOP

LOOP	
		GOTO LOOP
		END